<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Syqlorix â†’ APK (one-click)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
   :root{--bg:#0d1117;--fg:#c9d1d9;--accent:#238636}
   body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh}
   h1{margin:.2em 0}
   #drop{border:2px dashed var(--accent);padding:3em;border-radius:8px;text-align:center;cursor:pointer}
   #drop.dragover{background:#161b22}
   #apkLink{display:none;margin-top:1em;font-size:1.2em;color:var(--accent)}
   progress{width:100%;max-width:320px;margin-top:1em}
  </style>
</head>
<body>
  <h1>Syqlorix â†’ Android APK</h1>
  <p>Drop your <code>.zip</code> (or select files) â†’ instant APK.</p>

  <input id="fileInput" type="file" webkitdirectory multiple hidden>
  <div id="drop">Drop folder / zip here or <u>browse</u></div>

  <progress id="progress" max="100" value="0"></progress>
  <a id="apkLink" download="app-debug.apk">â¬‡ Download APK</a>

  <!-- ðŸ§© WASM runtime & packer -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apk-writer@1.1.0/dist/apk-writer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pyodide@0.25.0/pyodide.js"></script>

  <script type="module">
   const fileInput = document.getElementById('fileInput');
   const drop      = document.getElementById('drop');
   const progress  = document.getElementById('progress');
   const apkLink   = document.getElementById('apkLink');

   drop.onclick   = () => fileInput.click();
   ['dragenter','dragover'].forEach(e=>drop.addEventListener(e,()=>drop.classList.add('dragover')));
   ['dragleave','drop'].forEach(e=>drop.addEventListener(e,()=>drop.classList.remove('dragover')));
   ['drop', 'change'].forEach(evt =>
     window.addEventListener(evt, async (e) => {
       const files = e.target.files || [...e.dataTransfer.files];
       if (!files.length) return;
       progress.style.display = 'block';
       apkLink.style.display = 'none';
       const apkBlob = await buildApk(files);
       apkLink.href = URL.createObjectURL(apkBlob);
       apkLink.style.display = 'inline-block';
       progress.style.display = 'none';
     })
   );

   async function buildApk(files){
     const zip = new JSZip();
     files.forEach(f=> zip.file(f.webkitRelativePath || f.name, f));
     // inject minimal Android wrapper
     const wrapper = `from kivy.app import App
from kivy.uix.webview import WebView
import os, threading, sys, json
sys.path.insert(0, os.getcwd())
exec(open('main.py').read())   # loads Syqlorix 'doc'
class Wrapper(App):
    def build(self):
        threading.Thread(target=lambda: doc.run(file_path='main.py', host='127.0.0.1',port=5000),daemon=True).start()
        return WebView(url='http://127.0.0.1:5000')
Wrapper().run()`;
     zip.file('wrapper.py', wrapper);
     zip.file('main.py', zip.file('app.py') ? zip.file('app.py').async('string') : zip.file('main.py').async('string'));
     const zipBlob = await zip.generateAsync({type:'blob'}, meta=>progress.value = meta.percent);
     return await APKWriter.create(zipBlob, {package:'com.syqlorix.app', label:'SyqlorixPWA'});
   }
  </script>
</body>
</html>